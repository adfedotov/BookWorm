{% extends 'layout.html' %}

{% block content %}
<div class="fluid-container book-search">
  <div class="book-search-text">
    <h3>Find your book.</h3>
  </div>
  <div class="book-search-block">
    <input type="text" id="book-search" placeholder="Title, author, isbn ...">
    <div class="book-search-block-results">
      <div class="book-result">
        <img src="https://covers.openlibrary.org/b/id/7144197-S.jpg" alt="">
        <div class="book-result-text">
          <h4>test</h4>
          <small>test</small>
        </div>
        <a href="#"></a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
  var book;
  $('#book-search').on('keyup', function(e){
    console.log("type");
    var input = $(this).val();
    $.getJSON({
      url: 'http://openlibrary.org/search.json',
      beforeSend: function(xhr){
        if (xhr.overrideMimeType){
          xhr.overrideMimeType("application/json");
        }
      },
      dataType: 'json',
      data: {q: input},
      success: function(books) {
        console.log(books);
        book = books;
        $('.book-search-block-results').empty();
        for (var i = 0; i < 5; i++) {
          if (books["docs"][i] == null) { break; }
          $('.book-search-block-results').append(`
            <div class="book-result">
              <img src="http://covers.openlibrary.org/b/olid/${books["docs"][i]["edition_key"][0]}-M.jpg" alt="Book Cover">
              <div class="book-result-text">
                <h4>${books["docs"][i]["title"]}</h4>
                <small>by ${books["docs"][i]["author_name"]}</small>
              </div>
              <a href="#"></a>
            </div>`
          );
        }
      }
    });
  });
  var quill = new Quill('#editor-container', {
    modules: {
      toolbar: [
        ['bold', 'italic'],
        ['link', 'blockquote', 'code-block', 'image'],
        [{ list: 'ordered' }, { list: 'bullet' }]
      ]
    },
    placeholder: 'Compose an epic...',
    theme: 'snow'
  });

  $('form').submit(function() {
    $('input[name=text]').val(JSON.stringify(quill.getContents()));
    console.log("Submitted", $(this).serialize(), $(this).serializeArray());
  });

</script>
{% endblock %}
